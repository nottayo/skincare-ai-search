!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).React,t.ReactDOM)}(this,function(t,e){"use strict";var n,o,a={exports:{}},i={};var r=(o||(o=1,a.exports=function(){if(n)return i;n=1;var e=t,o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,c=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(t,e,n){var a,i={},l=null,d=null;for(a in void 0!==n&&(l=""+n),void 0!==e.key&&(l=""+e.key),void 0!==e.ref&&(d=e.ref),e)r.call(e,a)&&!s.hasOwnProperty(a)&&(i[a]=e[a]);if(t&&t.defaultProps)for(a in e=t.defaultProps)void 0===i[a]&&(i[a]=e[a]);return{$$typeof:o,type:t,key:l,ref:d,props:i,_owner:c.current}}return i.Fragment=a,i.jsx=l,i.jsxs=l,i}()),a.exports);const c=()=>{const[e,n]=t.useState([]),[o,a]=t.useState(!1),[i,c]=t.useState(""),[s,l]=t.useState([]),[d,u]=t.useState(""),[m,h]=t.useState(!1),[p,f]=t.useState(null),y=t.useRef(null);t.useEffect(()=>{const t=localStorage.getItem("mamatega_cart_expires");t&&f(t);const e=localStorage.getItem("mamatega_cart_id");if(e){const t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:5001":`http://${window.location.hostname}:5001`;c(`${t}/cart/${e}`),u(e)}const o=()=>{fetch("/cart.js").then(t=>t.json()).then(t=>{const e=t.items||[],o=e.map(t=>t.id).sort(),a=s.map(t=>t.id).sort();JSON.stringify(o)!==JSON.stringify(a)&&(n(e),l(e),e.length>0?w(e):(c(""),u("")))}).catch(t=>{})};return o(),y.current=setInterval(o,3e4),()=>{y.current&&clearInterval(y.current)}},[s]);const w=async t=>{if(0!==t.length){a(!0);try{const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:5001/api/cart/create":`http://${window.location.hostname}:5001/api/cart/create`,n=localStorage.getItem("mamatega_cart_id"),o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t,existing_cart_id:n,user_info:{user_agent:navigator.userAgent,timestamp:(new Date).toISOString(),source:"dynamic_checkout_widget",referrer:window.location.href}})});if(o.ok){const t=await o.json();u(t.cart_id);const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,n=`${e?"http://localhost:5001":`http://${window.location.hostname}:5001`}/cart/${t.cart_id}`;c(n),localStorage.setItem("mamatega_cart_id",t.cart_id),localStorage.setItem("mamatega_cart_expires",t.expires_at),f(t.expires_at)}}catch(e){}finally{a(!1)}}},_=(()=>{const t=p||localStorage.getItem("mamatega_cart_expires");if(!t)return null;const e=new Date,n=new Date(t);if(isNaN(n.getTime()))return null;const o=n-e;if(o<=0)return"Expired";const a=Math.floor(o/36e5),i=Math.floor(o%36e5/6e4);return isNaN(a)||isNaN(i)?null:`${a}h ${i}m`})();return r.jsx("div",{className:"dynamic-checkout-container",children:r.jsx("button",{className:"dynamic-checkout-btn",onClick:()=>{i?window.open(i,"_blank"):e.length>0&&w(e)},disabled:o,title:i?`Click to view cart page (Expires in: ${_||"Unknown"})`:"Add items to cart first",children:o?r.jsx("span",{className:"loading-spinner",children:"â³"}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"checkout-icon",children:"ðŸ›’"}),r.jsxs("span",{className:"checkout-text",children:[e.reduce((t,e)=>t+(e.quantity||1),0)," items",_&&"Expired"!==_&&r.jsx("span",{style:{fontSize:"11px",display:"block",opacity:.8},children:"Expires in 30 days"}),!_&&e.length>0&&r.jsx("span",{style:{fontSize:"11px",display:"block",opacity:.8},children:"Click to create cart"})]})]})})})};window.initDynamicCheckout=function(n="dynamic-checkout-container"){let o=document.getElementById(n);return o||(o=document.createElement("div"),o.id=n,document.body.appendChild(o)),e.render(r.jsx(t.StrictMode,{children:r.jsx(c,{})}),o),function(){e.unmountComponentAtNode(o),o.parentNode&&o.parentNode.removeChild(o)}},"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.initDynamicCheckout()}):window.initDynamicCheckout()),"undefined"!=typeof module&&module.exports&&(module.exports={initDynamicCheckout:window.initDynamicCheckout})});
//# sourceMappingURL=dynamic-checkout-widget.umd.js.map



