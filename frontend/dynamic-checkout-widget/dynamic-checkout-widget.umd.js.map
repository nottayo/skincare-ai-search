{"version":3,"file":"dynamic-checkout-widget.umd.js","sources":["../node_modules/react/jsx-runtime.js","../node_modules/react/cjs/react-jsx-runtime.production.min.js","../src/components/DynamicCheckout.jsx","../src/components/dynamic-checkout-widget.jsx"],"sourcesContent":["'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","import React, { useState, useEffect, useRef } from 'react';\nimport './DynamicCheckout.css';\n\nconst DynamicCheckout = () => {\n  const [cartItems, setCartItems] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [cartUrl, setCartUrl] = useState('');\n  const [lastCartState, setLastCartState] = useState([]);\n  const [cartId, setCartId] = useState('');\n  const [showCopied, setShowCopied] = useState(false);\n  const [cartExpiresAt, setCartExpiresAt] = useState(null);\n  const intervalRef = useRef(null);\n\n  // Monitor cart changes\n  useEffect(() => {\n    // Load existing cart expiry time\n    const existingExpiresAt = localStorage.getItem('mamatega_cart_expires');\n    if (existingExpiresAt) {\n      setCartExpiresAt(existingExpiresAt);\n    }\n    \n    // Load existing cart URL and update it to use backend URL\n    const existingCartId = localStorage.getItem('mamatega_cart_id');\n    if (existingCartId) {\n      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n      const backendUrl = isLocalhost ? 'http://localhost:5001' : `http://${window.location.hostname}:5001`;\n      const fullCartUrl = `${backendUrl}/cart/${existingCartId}`;\n      setCartUrl(fullCartUrl);\n      setCartId(existingCartId);\n    }\n    \n    const checkCart = () => {\n      fetch('/cart.js')\n        .then(res => res.json())\n        .then(cart => {\n          const currentCartItems = cart.items || [];\n          const currentCartIds = currentCartItems.map(item => item.id).sort();\n          const lastCartIds = lastCartState.map(item => item.id).sort();\n          \n          // Check if cart actually changed\n          if (JSON.stringify(currentCartIds) !== JSON.stringify(lastCartIds)) {\n            setCartItems(currentCartItems);\n            setLastCartState(currentCartItems);\n            \n            // Create or update cart page if items exist\n            if (currentCartItems.length > 0) {\n              createOrUpdateCartPage(currentCartItems);\n            } else {\n              setCartUrl('');\n              setCartId('');\n            }\n          }\n        })\n        .catch(error => {\n          console.error('Error fetching cart:', error);\n        });\n    };\n\n    // Check cart immediately\n    checkCart();\n\n    // Set up interval to check cart every 30 seconds\n    intervalRef.current = setInterval(checkCart, 30000);\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [lastCartState]);\n\n  const createOrUpdateCartPage = async (items) => {\n    if (items.length === 0) return;\n    \n    setIsLoading(true);\n    try {\n      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n      const API_URL = isLocalhost ? 'http://localhost:5001/api/cart/create' : `http://${window.location.hostname}:5001/api/cart/create`;\n      \n      // Get existing cart ID from localStorage\n      const existingCartId = localStorage.getItem('mamatega_cart_id');\n      \n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          items: items,\n          existing_cart_id: existingCartId,\n          user_info: {\n            user_agent: navigator.userAgent,\n            timestamp: new Date().toISOString(),\n            source: 'dynamic_checkout_widget',\n            referrer: window.location.href\n          }\n        })\n      });\n      \n      if (response.ok) {\n        const cartData = await response.json();\n        setCartId(cartData.cart_id);\n        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n        const backendUrl = isLocalhost ? 'http://localhost:5001' : `http://${window.location.hostname}:5001`;\n        const fullCartUrl = `${backendUrl}/cart/${cartData.cart_id}`;\n        setCartUrl(fullCartUrl);\n        \n        // Store cart ID in localStorage for persistence\n        localStorage.setItem('mamatega_cart_id', cartData.cart_id);\n        localStorage.setItem('mamatega_cart_expires', cartData.expires_at);\n        setCartExpiresAt(cartData.expires_at);\n      }\n    } catch (error) {\n      console.error('Error creating cart page:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCheckoutClick = () => {\n    if (cartUrl) {\n      // Open cart page in new tab\n      window.open(cartUrl, '_blank');\n    } else if (cartItems.length > 0) {\n      // If no cart URL but items exist, create cart first\n      createOrUpdateCartPage(cartItems);\n    }\n  };\n\n  const copyCartLink = async () => {\n    if (cartUrl) {\n      try {\n        await navigator.clipboard.writeText(cartUrl);\n        setShowCopied(true);\n        setTimeout(() => setShowCopied(false), 2000);\n      } catch (error) {\n        console.error('Failed to copy link:', error);\n      }\n    }\n  };\n\n  const getTotalItems = () => {\n    return cartItems.reduce((total, item) => total + (item.quantity || 1), 0);\n  };\n\n  const getTimeRemaining = () => {\n    const expiresAt = cartExpiresAt || localStorage.getItem('mamatega_cart_expires');\n    if (!expiresAt) return null;\n    \n    const now = new Date();\n    const expiry = new Date(expiresAt);\n    \n    // Check if the date is valid\n    if (isNaN(expiry.getTime())) return null;\n    \n    const timeRemaining = expiry - now;\n    \n    if (timeRemaining <= 0) return 'Expired';\n    \n    const hours = Math.floor(timeRemaining / (1000 * 60 * 60));\n    const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));\n    \n    // Check if calculations are valid\n    if (isNaN(hours) || isNaN(minutes)) return null;\n    \n    return `${hours}h ${minutes}m`;\n  };\n\n  const timeRemaining = getTimeRemaining();\n\n  return (\n    <div className=\"dynamic-checkout-container\">\n      <button \n        className=\"dynamic-checkout-btn\"\n        onClick={handleCheckoutClick}\n        disabled={isLoading}\n        title={cartUrl ? `Click to view cart page (Expires in: ${timeRemaining || 'Unknown'})` : 'Add items to cart first'}\n      >\n        {isLoading ? (\n          <span className=\"loading-spinner\">‚è≥</span>\n        ) : (\n          <>\n            <span className=\"checkout-icon\">üõí</span>\n                      <span className=\"checkout-text\">\n            {getTotalItems()} items\n            {timeRemaining && timeRemaining !== 'Expired' && (\n              <span style={{ fontSize: '11px', display: 'block', opacity: 0.8 }}>\n                Expires in 30 days\n              </span>\n            )}\n            {!timeRemaining && cartItems.length > 0 && (\n              <span style={{ fontSize: '11px', display: 'block', opacity: 0.8 }}>\n                Click to create cart\n              </span>\n            )}\n          </span>\n          </>\n        )}\n      </button>\n      \n\n    </div>\n  );\n};\n\nexport default DynamicCheckout; ","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport DynamicCheckout from './DynamicCheckout';\nimport './DynamicCheckout.css';\n\n// Widget initialization function\nwindow.initDynamicCheckout = function(containerId = 'dynamic-checkout-container') {\n  // Create container if it doesn't exist\n  let container = document.getElementById(containerId);\n  if (!container) {\n    container = document.createElement('div');\n    container.id = containerId;\n    document.body.appendChild(container);\n  }\n\n  // Render the widget\n  ReactDOM.render(\n    <React.StrictMode>\n      <DynamicCheckout />\n    </React.StrictMode>,\n    container\n  );\n\n  // Return cleanup function\n  return function() {\n    ReactDOM.unmountComponentAtNode(container);\n    if (container.parentNode) {\n      container.parentNode.removeChild(container);\n    }\n  };\n};\n\n// Auto-initialize if script is loaded directly\nif (typeof document !== 'undefined') {\n  // Wait for DOM to be ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      window.initDynamicCheckout();\n    });\n  } else {\n    window.initDynamicCheckout();\n  }\n}\n\n// Export for module systems\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = { initDynamicCheckout: window.initDynamicCheckout };\n} "],"names":["jsxRuntimeModule","exports","f","require$$0","k","Symbol","for","l","m","Object","prototype","hasOwnProperty","n","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","p","key","ref","__self","__source","q","c","a","g","b","d","e","h","call","defaultProps","$$typeof","type","props","_owner","current","reactJsxRuntime_production_min","jsx","jsxs","DynamicCheckout","cartItems","setCartItems","useState","isLoading","setIsLoading","cartUrl","setCartUrl","lastCartState","setLastCartState","cartId","setCartId","showCopied","setShowCopied","cartExpiresAt","setCartExpiresAt","intervalRef","useRef","useEffect","existingExpiresAt","localStorage","getItem","existingCartId","backendUrl","window","location","hostname","checkCart","fetch","then","res","json","cart","currentCartItems","items","currentCartIds","map","item","id","sort","lastCartIds","JSON","stringify","length","createOrUpdateCartPage","catch","error","setInterval","clearInterval","async","API_URL","response","method","headers","body","existing_cart_id","user_info","user_agent","navigator","userAgent","timestamp","Date","toISOString","source","referrer","href","ok","cartData","cart_id","isLocalhost","fullCartUrl","setItem","expires_at","timeRemaining","expiresAt","now","expiry","isNaN","getTime","hours","Math","floor","minutes","getTimeRemaining","className","children","onClick","open","disabled","title","Fragment","reduce","total","quantity","style","fontSize","display","opacity","initDynamicCheckout","containerId","container","document","getElementById","createElement","appendChild","ReactDOM","render","React","StrictMode","unmountComponentAtNode","parentNode","removeChild","readyState","addEventListener","module"],"mappings":"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","x_google_ignoreList":[0,1]}

