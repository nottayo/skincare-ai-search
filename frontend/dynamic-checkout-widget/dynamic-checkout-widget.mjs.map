{"version":3,"file":"dynamic-checkout-widget.mjs","sources":["../node_modules/react/cjs/react-jsx-runtime.production.min.js","../node_modules/react/jsx-runtime.js","../src/components/DynamicCheckout.jsx","../src/components/dynamic-checkout-widget.jsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport './DynamicCheckout.css';\n\nconst DynamicCheckout = () => {\n  const [cartItems, setCartItems] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [cartUrl, setCartUrl] = useState('');\n  const [lastCartState, setLastCartState] = useState([]);\n  const [cartId, setCartId] = useState('');\n  const [showCopied, setShowCopied] = useState(false);\n  const [cartExpiresAt, setCartExpiresAt] = useState(null);\n  const intervalRef = useRef(null);\n\n  // Monitor cart changes\n  useEffect(() => {\n    // Load existing cart expiry time\n    const existingExpiresAt = localStorage.getItem('mamatega_cart_expires');\n    if (existingExpiresAt) {\n      setCartExpiresAt(existingExpiresAt);\n    }\n    \n    // Load existing cart URL and update it to use backend URL\n    const existingCartId = localStorage.getItem('mamatega_cart_id');\n    if (existingCartId) {\n      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n      const backendUrl = isLocalhost ? 'http://localhost:5001' : `http://${window.location.hostname}:5001`;\n      const fullCartUrl = `${backendUrl}/cart/${existingCartId}`;\n      setCartUrl(fullCartUrl);\n      setCartId(existingCartId);\n    }\n    \n    const checkCart = () => {\n      fetch('/cart.js')\n        .then(res => res.json())\n        .then(cart => {\n          const currentCartItems = cart.items || [];\n          const currentCartIds = currentCartItems.map(item => item.id).sort();\n          const lastCartIds = lastCartState.map(item => item.id).sort();\n          \n          // Check if cart actually changed\n          if (JSON.stringify(currentCartIds) !== JSON.stringify(lastCartIds)) {\n            setCartItems(currentCartItems);\n            setLastCartState(currentCartItems);\n            \n            // Create or update cart page if items exist\n            if (currentCartItems.length > 0) {\n              createOrUpdateCartPage(currentCartItems);\n            } else {\n              setCartUrl('');\n              setCartId('');\n            }\n          }\n        })\n        .catch(error => {\n          console.error('Error fetching cart:', error);\n        });\n    };\n\n    // Check cart immediately\n    checkCart();\n\n    // Set up interval to check cart every 30 seconds\n    intervalRef.current = setInterval(checkCart, 30000);\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [lastCartState]);\n\n  const createOrUpdateCartPage = async (items) => {\n    if (items.length === 0) return;\n    \n    setIsLoading(true);\n    try {\n      const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n      const API_URL = isLocalhost ? 'http://localhost:5001/api/cart/create' : `http://${window.location.hostname}:5001/api/cart/create`;\n      \n      // Get existing cart ID from localStorage\n      const existingCartId = localStorage.getItem('mamatega_cart_id');\n      \n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          items: items,\n          existing_cart_id: existingCartId,\n          user_info: {\n            user_agent: navigator.userAgent,\n            timestamp: new Date().toISOString(),\n            source: 'dynamic_checkout_widget',\n            referrer: window.location.href\n          }\n        })\n      });\n      \n      if (response.ok) {\n        const cartData = await response.json();\n        setCartId(cartData.cart_id);\n        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';\n        const backendUrl = isLocalhost ? 'http://localhost:5001' : `http://${window.location.hostname}:5001`;\n        const fullCartUrl = `${backendUrl}/cart/${cartData.cart_id}`;\n        setCartUrl(fullCartUrl);\n        \n        // Store cart ID in localStorage for persistence\n        localStorage.setItem('mamatega_cart_id', cartData.cart_id);\n        localStorage.setItem('mamatega_cart_expires', cartData.expires_at);\n        setCartExpiresAt(cartData.expires_at);\n      }\n    } catch (error) {\n      console.error('Error creating cart page:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCheckoutClick = () => {\n    if (cartUrl) {\n      // Open cart page in new tab\n      window.open(cartUrl, '_blank');\n    } else if (cartItems.length > 0) {\n      // If no cart URL but items exist, create cart first\n      createOrUpdateCartPage(cartItems);\n    }\n  };\n\n  const copyCartLink = async () => {\n    if (cartUrl) {\n      try {\n        await navigator.clipboard.writeText(cartUrl);\n        setShowCopied(true);\n        setTimeout(() => setShowCopied(false), 2000);\n      } catch (error) {\n        console.error('Failed to copy link:', error);\n      }\n    }\n  };\n\n  const getTotalItems = () => {\n    return cartItems.reduce((total, item) => total + (item.quantity || 1), 0);\n  };\n\n  const getTimeRemaining = () => {\n    const expiresAt = cartExpiresAt || localStorage.getItem('mamatega_cart_expires');\n    if (!expiresAt) return null;\n    \n    const now = new Date();\n    const expiry = new Date(expiresAt);\n    \n    // Check if the date is valid\n    if (isNaN(expiry.getTime())) return null;\n    \n    const timeRemaining = expiry - now;\n    \n    if (timeRemaining <= 0) return 'Expired';\n    \n    const hours = Math.floor(timeRemaining / (1000 * 60 * 60));\n    const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));\n    \n    // Check if calculations are valid\n    if (isNaN(hours) || isNaN(minutes)) return null;\n    \n    return `${hours}h ${minutes}m`;\n  };\n\n  const timeRemaining = getTimeRemaining();\n\n  return (\n    <div className=\"dynamic-checkout-container\">\n      <button \n        className=\"dynamic-checkout-btn\"\n        onClick={handleCheckoutClick}\n        disabled={isLoading}\n        title={cartUrl ? `Click to view cart page (Expires in: ${timeRemaining || 'Unknown'})` : 'Add items to cart first'}\n      >\n        {isLoading ? (\n          <span className=\"loading-spinner\">‚è≥</span>\n        ) : (\n          <>\n            <span className=\"checkout-icon\">üõí</span>\n                      <span className=\"checkout-text\">\n            {getTotalItems()} items\n            {timeRemaining && timeRemaining !== 'Expired' && (\n              <span style={{ fontSize: '11px', display: 'block', opacity: 0.8 }}>\n                Expires in 30 days\n              </span>\n            )}\n            {!timeRemaining && cartItems.length > 0 && (\n              <span style={{ fontSize: '11px', display: 'block', opacity: 0.8 }}>\n                Click to create cart\n              </span>\n            )}\n          </span>\n          </>\n        )}\n      </button>\n      \n\n    </div>\n  );\n};\n\nexport default DynamicCheckout; ","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport DynamicCheckout from './DynamicCheckout';\nimport './DynamicCheckout.css';\n\n// Widget initialization function\nwindow.initDynamicCheckout = function(containerId = 'dynamic-checkout-container') {\n  // Create container if it doesn't exist\n  let container = document.getElementById(containerId);\n  if (!container) {\n    container = document.createElement('div');\n    container.id = containerId;\n    document.body.appendChild(container);\n  }\n\n  // Render the widget\n  ReactDOM.render(\n    <React.StrictMode>\n      <DynamicCheckout />\n    </React.StrictMode>,\n    container\n  );\n\n  // Return cleanup function\n  return function() {\n    ReactDOM.unmountComponentAtNode(container);\n    if (container.parentNode) {\n      container.parentNode.removeChild(container);\n    }\n  };\n};\n\n// Auto-initialize if script is loaded directly\nif (typeof document !== 'undefined') {\n  // Wait for DOM to be ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      window.initDynamicCheckout();\n    });\n  } else {\n    window.initDynamicCheckout();\n  }\n}\n\n// Export for module systems\nif (typeof module !== 'undefined' && module.exports) {\n  module.exports = { initDynamicCheckout: window.initDynamicCheckout };\n} "],"names":["jsxRuntimeModule","require$$0","isLocalhost","timeRemaining","jsx","jsxs","Fragment","React"],"mappings":"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","x_google_ignoreList":[0,1]}

